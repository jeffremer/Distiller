<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="en">
<head>
    <meta http-equiv="Content-type" content="text/html; charset=UTF-8" />
	<title>Evaluator</title>
	<style>
		body {
			font-family:"Lucida Grande",TrebuchetMS,"Trebuchet MS","Helvetica Neue",Verdana,Helvetica,Arial,sans-serif;
			font-size:14px;
			line-height:150%;
		}
		#main {
			width: 600px;
			margin: 0 auto;
		}
		#main fieldset ul, #main fieldset ul li {
			list-style-type: none;
			margin: 0;
			padding: 0 0 5px 0;
		}
		#main fieldset textarea {
			width: 100%;
			height: 200px;
		}
		#main fieldset textarea.short {
			width: 100%;
			height: 100px;
		}
		#main fieldset label {
			float: left;
			width: 6em;
		}
		#main fieldset input.url {
			width: 43em;
			float: right;
		}
		#main fieldset label.url {
			width: 2em;
		}
		p.right {
			text-align: right;
		}
		p.left {
			text-align: left;
		}
	</style>
	<script src="http://ajax.googleapis.com/ajax/libs/jquery/1.4.2/jquery.min.js" type="text/javascript"></script>
	<script type="text/javascript">
		function go() {
			$('#result').load('/eval', $('#data').serialize(), function() {
				var resultUrl = '/eval?url=' + encodeURIComponent($('#url').val()) + '&code=' + encodeURIComponent($('#code').val());
				if($('#username').val() && $('#password').val()) {
					resultUrl += '&username=' + encodeURIComponent($('#username').val());
					resultUrl += '&password=' + encodeURIComponent($('#password').val());
				}
				if($('#urlCode').val()) {
					resultUrl += "&urlCode=" + encodeURIComponent($('#urlCode').val());
				}
				resultUrl += '&token=' + encodeURIComponent($('#token').val());
				resultUrl += '&contentType=' + encodeURIComponent($('#contentType').val());
				$('#resultUrl').val(resultUrl);
				$('#resultUrlA').show();
				$('#resultUrlA').html(resultUrl.substr(0,50) + '...');
				$('#resultUrlA').attr('href', resultUrl);
			});
			return false;
		}
	</script>
</head>
<body>
	<div id="main">
		<h1>Evaluator</h1>
		<p>Evaluator is a javascript aware content proxy.  Pass in a URL - evaluator will download the content
			and assign the body to a special variable named DATA.  Use the DATA variable in a set of javascript
			 statements and assign your final result to RETURN_VALUE.  XML and JSON are automatically parsed.  Evaluator will run your javascript block on the server and then display the result of your transformation below.</p>
		<form method="GET" action="/eval" id="data" onsubmit="submit()">
			<fieldset>
			<ul>
				<li>
					<label for="url" class="url">URL</label>
					<input type="text" name="url" class="url" id="url" placeholder="URL"/>
					<div style="clear:both;"></div>
				</li>
				
				<li>
					<textarea name="code" id="code"></textarea>
					<p class="right"><small>Code</small></p>	
				</li>
				<li>
					<textarea name="urlCode" id="urlCode" class="short"></textarea>
					<p class="right"><small>URL Transformation Code - Optional</small></p>	
				</li>
				<li>
					<label for="contentType">Output</label>
					<input type="text" name="contentType" id="contentType" value="text/plain"/>
				</li>						
				<li>
					<label for="username" id="Token">Token</label>
					<input type="text" name="token" id="token" value="1234567890"/>
				</li>
				<li>
					Basic AUTH<br>
					<small>Optional, if your end point requires authorization enter your credentials here.</small>
				</li>
				<li>
					<label for="username" >Username</label>
					<input type="text" id="username" name="username"/>
				</li>
				<li>
					<label for="password">Password</label>
					<input type="text" id="password" name="password"/>
				</li>
	
				<li>
					<p class="right">
						<input type="button" value="Submit" onclick="go(); return false;">
					</p>
				</li>
			</ul>
			</fieldset>
		</form>
		<h2>Result</h2>
		<form>
			<fieldset>
				<ul>
					<li>
						<textarea id="result"></textarea>
						<p class="left"><small>Evaluated Code</small></p>	
					</li>
					<li>
						<input type="text" id="resultUrl" style="width: 100%;"/>
						<a href="#" id="resultUrlA" style="display: none;">Result URL</a>
						<p class="left"><small>API Call</small></p>	
					</li>
				</ul>
			</fieldset>
		</form>
	</div>
</body>
</html>